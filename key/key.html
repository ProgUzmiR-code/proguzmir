<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <img src="/image/bg-lucky-code.jpg" alt="" style=" margin-top: 50px;">
    <div>
        <center><img src="/image/lukcy.png" alt="">
            <div class="lukcys">
                <h3>Lucky Code</h3>
                <button id="keyBack" class="btn">Back</button>
            </div>
            <p>Find the lucky code in the video to get rewards</p>
        </center>
        <div id="key1">
            <div class="shaffof">
                <a href="https://youtu.be/HmaQwuKUYTc?si=blIzy-4IF_kIP7dO"></a>
                <div class="youtubepaf">
                    <img width="50" class="fa-shake" src="/image/youtube.svg" alt="">
                </div>
                <div class="youtubetext">
                    <p>The Curve That Controls Your Coins?! Learn in Bonding Curve</p>
                    <div class="dflex">
                        <span>300,000</span>
                        <img class="key" src="/image/key.png" alt=""> 1
                    </div>
                </div>
                <img src="./image/arrow.svg" alt="">
            </div>
        </div>
        <div id="key2">
            <div class="shaffof">
                <a href="https://youtu.be/b_8fHNIHFk4?si=D05wCEy9MPqUwG_V"></a>
                <div class="youtubepaf">
                    <img width="50" class="fa-shake" src="/image/youtube.svg" alt="">
                </div>
                <div class="youtubetext">
                    <p>wwThe Curve That Controls Your Coins?! Learn in Bonding Curve</p>
                    <div class="dflex">
                        <span>300,000</span>
                        <img class="key" src="/image/key.png" alt=""> 1
                    </div>
                </div>
                <img src="./image/arrow.svg" alt="">
            </div>
        </div>
    </div>


    <div id="pop">
        <div class="pop-dialog" show="true">
            <div class="shadow"></div>
            <div class="dialog-main center" style="width: 95%; height: auto;">
                <div class="btn-close">
                    <span class="material-icons-outlined">close</span>
                </div>
                <div class="pop-main">
                    <div class="energy__title"> Watch the video to get rewards
                    </div>
                    <div class="number-box">
                        <div class="number__title">Watch the video, find the Lucky
                            Code and pasteit here</div>
                        <div class="number__items">
                            <input class="verification-input">
                        </div>
                    </div><!---->
                    <div class="btn-submit dis"> Submit </div>
                    <div class="upsubmit"></div>
                    <div class="btns">
                        <div class="btn">Watch</div>
                    </div>
                </div>

            </div>
        </div>
    </div>
    </div>
   
    <script>
        (() => {


            const popModal = document.getElementById('pop');
            console.log('popModal:', popModal);
            const upsubmitDiv = popModal.querySelector('.upsubmit');
            console.log('upsubmitDiv:', upsubmitDiv);
            const watchBtn = popModal.querySelector('.pop-main .btns .btn');
            console.log('btnClose:', watchBtn);

            const btnClose = popModal.querySelector('.btn-close');
            console.log('btnClose:', btnClose);
            const shadow = popModal.querySelector('.shadow');
            console.log('shadow:', shadow);

            /* ===============================
               FUNKSIYA: Modal oynasidagi .shaffof uchun event listener bind qilish
            ================================ */
            function bindShaffofClickListener() {
                // eski listenerlarni olib tashlash uchun - event delegation orqali modal kontentida
                // Modal ichidagi shaffofga click bo'lsa linkni ochish
                const modal = document.getElementById('pop');

                console.log('bindShaffofClickListener - modal:', modal);
                // eski listener mavjud bo'lsa olib tashla
                modal.removeEventListener('click', handleShaffofClick);

                // yangi listener qo'sh
                modal.addEventListener('click', handleShaffofClick);
            }

            function handleShaffofClick(e) {
                const shaffof = e.target.closest('.upsubmit .shaffof');
                console.log('handleShaffofClick - shaffof:', shaffof);
                if (!shaffof) return;

                const link = shaffof.querySelector('a');
                console.log('link:', link);
                if (link?.href) {
                    window.open(link.href, '_blank');
                }
            }

            /* ===============================
               1️⃣ KEY BOSILISHI (DELEGATION)
            ================================ */
            document.addEventListener('click', function (e) {
                const keyDiv = e.target.closest('[id^="key"]');
                console.log('keyDiv:', keyDiv);

                if (!keyDiv) return;

                const shaffofContent = keyDiv.querySelector('.shaffof');
                console.log('shaffofContent:', shaffofContent);

                if (!shaffofContent) return;

                const cloned = shaffofContent.cloneNode(true);
                console.log('cloned:', cloned);

                upsubmitDiv.innerHTML = '';
                upsubmitDiv.appendChild(cloned);

                const videoLink = cloned.querySelector('a');
                if (videoLink?.href) {
                    watchBtn.dataset.videoUrl = videoLink.href;
                }

                popModal.classList.add('show');

                // Modal ochilganidan keyin .shaffof listener bind qilish
                bindShaffofClickListener();
            });

            /* ===============================
               3️⃣ WATCH TUGMASI
            ================================ */
            watchBtn.onclick = function () {
                const url = this.dataset.videoUrl;
                if (url) window.open(url, '_blank');
            };

            /* ===============================
               4️⃣ MODAL YOPISH
            ================================ */
            btnClose.onclick = () => popModal.classList.remove('show');
            shadow.onclick = () => popModal.classList.remove('show');

            document.addEventListener('keydown', function (e) {
                if (e.key === 'Escape') {
                    popModal.classList.remove('show');
                }
            });
        })();
    </script>
</body>

</html>